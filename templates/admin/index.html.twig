{% extends 'base.html.twig' %}

{% block title %}Hello AdminController!{% endblock %}

{% block body %}
    <div style="overflow-x:auto;">
        <h3 style="text-align: center">Liste des Utilisateurs </h3>
        <table style="width: 100%;text-align: center" class="m-auto border table table-hover">
            <thead>
            <tr>
                <th scope="col">Pseudo</th>
                <th scope="col">Nom</th>
                <th scope="col">Prenom</th>
                <th scope="col">Mail</th>
                <th scope="col">Admin</th>
                <th scope="col">Actif</th>
                <th scope="col">Selection</th>
            </tr>
            </thead>
            <tbody id="myTable">
            <form> <!--action="{{ url('admin') }}" method="post" >-->
                {% for user in liste %}
                    <tr>
                        <td>{{ user.username }}</td>
                        <td>{{ user.nom }}</td>
                        <td>{{ user.prenom }}</td>
                        <td>{{ user.mail }}</td>
                        <td>{% if user.admin == true %}X{% endif %}</td>
                        <td>{% if user.actif == true %}X{% endif %}</td>
                        <td><input value="{{ user.id }}" type="checkbox"></td>
                    </tr>
                {% endfor %}
                <button id="1" type="none" onclick="activer(this.id)">Activer</button>
                <button id="2" type="none" onclick="activer(this.id)">Desactiver</button>
            </form>
            </tbody>
        </table>
    </div>
    <script>
        function activer(id) {
            let elchecked = document.forms[0];
            let tab = [];
            let i;
            for (i = 0; i < elchecked.length; i++) {
                if (elchecked[i].checked) {
                    tab.push(elchecked[i].value);
                }
            }
            let path = "{{ path('admin_desactiver') }}"
            if(id == 1)
                 path = "{{ path('admin_activer') }}";

            $.ajax({
                url : path,
                data : {liste : tab },
                method : "POST",
                success: function(data){
                    alert(data+" ont été modifié(s).");
                },
                error : function (jqXHR, status, error){
                    console.log('error ' + error);
                }
            });
            console.log(tab);
        }


    </script>
{% endblock %}
